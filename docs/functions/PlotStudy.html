<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PlotStudy</title>
  <meta name="keywords" content="PlotStudy">
  <meta name="description" content="% [handles, h2, hsp] = PlotStudy(data,myplot_handle)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html functions -->
<h1>PlotStudy
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% [handles, h2, hsp] = PlotStudy(data,myplot_handle)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [handles, hsp, h2]=PlotStudy(data,myplot_handle,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% [handles, h2, hsp] = PlotStudy(data,myplot_handle)
 Purpose: Applies a user-specified plotting function to each element of
     data structure. Arrays the output plots in a grid, similar to
     PlotData. Intended for use with results from simulation
     studies varying some aspect of the model or inputs. 
          
 Inputs:
     data: DynaSim data structure (see CheckData)
     myplot_handle: Handle for plotting function.
         **IMPORTANT**: This function should just produce a plot. It should
         not open any new figures or subplots. It can return an axis
         handle, but this is not necessary.
     options:
         'textfontsize' - default text font size of 10
         'use_subplot_grid' - turns on or off subplot grid. Default is on. Off might be faster.
 
 Outputs:
     handles: handle of the figure
     hsp: handle of subplot_grid object
     h2: return values of myplot_handle (usually will be Line handles)
 
 Examples:
     myfunc = @(x) plot(x.RS_V)
     figure; myunc(data(1));   % Single plot
     PlotFunc(data,@myfunc)    % Grid of all plots
 
 Dependencies
     Uses subplot_grid.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="CheckOptions.html" class="code" title="function parms = CheckOptions(options, options_schema, strict)">CheckOptions</a>	CHECKOPTIONS - organize key/value pairs in structure with default or user-supplied values according to a schema</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [handles, hsp, h2]=PlotStudy(data,myplot_handle,varargin)</a>
0002 <span class="comment">%% [handles, h2, hsp] = PlotStudy(data,myplot_handle)</span>
0003 <span class="comment">% Purpose: Applies a user-specified plotting function to each element of</span>
0004 <span class="comment">%     data structure. Arrays the output plots in a grid, similar to</span>
0005 <span class="comment">%     PlotData. Intended for use with results from simulation</span>
0006 <span class="comment">%     studies varying some aspect of the model or inputs.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Inputs:</span>
0009 <span class="comment">%     data: DynaSim data structure (see CheckData)</span>
0010 <span class="comment">%     myplot_handle: Handle for plotting function.</span>
0011 <span class="comment">%         **IMPORTANT**: This function should just produce a plot. It should</span>
0012 <span class="comment">%         not open any new figures or subplots. It can return an axis</span>
0013 <span class="comment">%         handle, but this is not necessary.</span>
0014 <span class="comment">%     options:</span>
0015 <span class="comment">%         'textfontsize' - default text font size of 10</span>
0016 <span class="comment">%         'use_subplot_grid' - turns on or off subplot grid. Default is on. Off might be faster.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% Outputs:</span>
0019 <span class="comment">%     handles: handle of the figure</span>
0020 <span class="comment">%     hsp: handle of subplot_grid object</span>
0021 <span class="comment">%     h2: return values of myplot_handle (usually will be Line handles)</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Examples:</span>
0024 <span class="comment">%     myfunc = @(x) plot(x.RS_V)</span>
0025 <span class="comment">%     figure; myunc(data(1));   % Single plot</span>
0026 <span class="comment">%     PlotFunc(data,@myfunc)    % Grid of all plots</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% Dependencies</span>
0029 <span class="comment">%     Uses subplot_grid.</span>
0030 
0031 
0032 <span class="comment">% data=CheckData(data);</span>
0033 handles=[];
0034 
0035 options=<a href="CheckOptions.html" class="code" title="function parms = CheckOptions(options, options_schema, strict)">CheckOptions</a>(varargin,{<span class="keyword">...</span>
0036   <span class="string">'textfontsize'</span>,10,[],<span class="keyword">...</span>
0037   <span class="string">'use_subplot_grid'</span>,1,{0,1},<span class="keyword">...</span>
0038   },false);
0039 
0040 
0041 textfontsize = options.textfontsize;
0042 use_subplot_grid = options.use_subplot_grid;
0043 
0044     
0045         
0046         
0047         <span class="comment">% New code (imported from PlotData)</span>
0048         num_sims=length(data); <span class="comment">% number of simulations</span>
0049         
0050         
0051         <span class="comment">% make subplot adjustments for varied parameters</span>
0052         <span class="keyword">if</span> num_sims&gt;1 &amp;&amp; isfield(data,<span class="string">'varied'</span>)
0053           <span class="comment">% collect info on parameters varied</span>
0054           varied=data(1).varied;
0055           num_varied=length(varied); <span class="comment">% number of model components varied across simulations</span>
0056           num_sims=length(data); <span class="comment">% number of data sets (one per simulation)</span>
0057           <span class="comment">% collect info on parameters varied</span>
0058           param_mat=zeros(num_sims,num_varied); <span class="comment">% values for each simulation</span>
0059           param_cell=cell(1,num_varied); <span class="comment">% unique values for each parameter</span>
0060           <span class="comment">% loop over varied components and collect values</span>
0061           <span class="keyword">for</span> j=1:num_varied
0062             <span class="keyword">if</span> isnumeric(data(1).(varied{j}))
0063               param_mat(:,j)=[data.(varied{j})]; <span class="comment">% values for each simulation</span>
0064               param_cell{j}=unique([data.(varied{j})]); <span class="comment">% unique values for each parameter</span>
0065             <span class="keyword">else</span>
0066               <span class="comment">% todo: handle sims varying non-numeric model components</span>
0067               <span class="comment">% (eg, mechanisms) (also in PlotFR and SelectData)</span>
0068             <span class="keyword">end</span>
0069           <span class="keyword">end</span>
0070           param_size=cellfun(@length,param_cell); <span class="comment">% number of unique values for each parameter</span>
0071           <span class="comment">% varied parameter with most elements goes along the rows (everything else goes along columns)</span>
0072           row_param_index=find(param_size==max(param_size),1,<span class="string">'first'</span>);
0073           row_param_name=varied{row_param_index};
0074           row_param_values=param_cell{row_param_index};
0075           num_rows=length(row_param_values);
0076           <span class="comment">%num_cols=num_sims/num_rows;</span>
0077           num_figs=1;
0078           <span class="comment">% collect sims for each value of the row parameter</span>
0079           indices={};
0080           <span class="keyword">for</span> row=1:num_rows
0081             indices{row}=find(param_mat(:,row_param_index)==row_param_values(row));
0082           <span class="keyword">end</span>
0083           num_per_row=cellfun(@length,indices);
0084           num_cols=max(num_per_row);
0085           sim_indices=nan(num_cols,num_rows);
0086           <span class="comment">% arrange sim indices for each row in a matrix</span>
0087           <span class="keyword">for</span> row=1:num_rows
0088             sim_indices(1:num_per_row(row),row)=indices{row};
0089           <span class="keyword">end</span>
0090         <span class="comment">%   sim_indices=[];</span>
0091         <span class="comment">%   for row=1:num_rows</span>
0092         <span class="comment">%     sim_indices=[sim_indices find(param_mat(:,row_param_index)==row_param_values(row))];</span>
0093         <span class="comment">%   end</span>
0094         <span class="keyword">else</span>
0095           sim_indices=ones(1,num_rows); <span class="comment">% index into data array</span>
0096           num_cols=1;
0097         <span class="keyword">end</span>
0098         
0099         ht=320; <span class="comment">% height per subplot row (=per population or FR data set)</span>
0100         handles(1) = figure(<span class="string">'units'</span>,<span class="string">'normalized'</span>,<span class="string">'position'</span>,[0,1-min(.33*num_rows,1),min(.25*num_cols,1) min(.33*num_rows,1)]);
0101         <span class="keyword">if</span> use_subplot_grid; hsp = subplot_grid(num_rows,num_cols); <span class="keyword">else</span>
0102             hsp=tight_subplot(num_rows,num_cols,[.01 .03],[.05 .01],[.03 .01]);
0103         <span class="keyword">end</span>
0104         
0105         
0106         axis_counter = 0;
0107         <span class="keyword">for</span> row=1:num_rows
0108             <span class="keyword">for</span> col=1:num_cols
0109                 
0110                 sim_index=sim_indices(col,row); <span class="comment">% index into data array for this subplot</span>
0111                 axis_counter=axis_counter+1; <span class="comment">% number subplot axis we're on</span>
0112                 <span class="keyword">if</span> isnan(sim_index)
0113                   <span class="keyword">continue</span>;
0114                 <span class="keyword">end</span>
0115                 
0116                 <span class="keyword">if</span> use_subplot_grid; hsp.set_gca(axis_counter); <span class="keyword">else</span>
0117                     set(gcf,<span class="string">'CurrentAxes'</span>,hsp(axis_counter));
0118                 <span class="keyword">end</span>
0119                     
0120                 
0121                 num_pops = 1;
0122                 <span class="keyword">if</span> isfield(data,<span class="string">'varied'</span>)
0123                   <span class="keyword">if</span> num_sims&gt;1
0124                     <span class="comment">% list the parameter varied along the rows first</span>
0125                     str=[row_param_name <span class="string">'='</span> num2str(row_param_values(row)) <span class="string">': '</span>];
0126                     <span class="keyword">for</span> k=1:num_varied
0127                       fld=data(sim_index).varied{k};
0128                       <span class="keyword">if</span> ~strcmp(fld,row_param_name)
0129                         val=data(sim_index).(fld);
0130                         str=[str fld <span class="string">'='</span> num2str(val) <span class="string">', '</span>];
0131                       <span class="keyword">end</span>
0132                     <span class="keyword">end</span>
0133                     <span class="keyword">if</span> num_pops&gt;1
0134                       legend_strings=cellfun(@(x)[x <span class="string">' (mean)'</span>],pop_names,<span class="string">'uni'</span>,0);
0135                     <span class="keyword">end</span>
0136                   <span class="keyword">else</span>
0137                     str=<span class="string">''</span>;
0138                     <span class="keyword">for</span> k=1:length(data.varied)
0139                       fld=data(sim_index).varied{k};
0140                       str=[str fld <span class="string">'='</span> num2str(data(sim_index).(fld)) <span class="string">', '</span>];
0141                     <span class="keyword">end</span>
0142                   <span class="keyword">end</span>
0143                   text_string{row,col}=[<span class="string">'('</span> strrep(str(1:end-2),<span class="string">'_'</span>,<span class="string">'\_'</span>) <span class="string">')'</span>];
0144                 <span class="keyword">end</span>
0145         
0146 
0147                 k=1;
0148                 i=sim_index;
0149                 
0150                 
0151                 <span class="comment">% get population name from field (assumes: pop_*)</span>
0152                 
0153                 
0154                 <span class="comment">% 1.0 plot firing rate heat map</span>
0155                     <span class="comment">%hsp.figtitle([ text_string{row,col}]);</span>
0156                     <span class="keyword">try</span>
0157                         h2{i} = myplot_handle(data(i));
0158                     <span class="keyword">catch</span>       <span class="comment">% If myplot_handle doesn't return an output</span>
0159                         myplot_handle(data(i));
0160                         h2{i} = [];
0161                     <span class="keyword">end</span>
0162                     title(text_string{row,col},<span class="string">'FontSize'</span>,textfontsize);
0163                     
0164                     set(gca,<span class="string">'FontSize'</span>,textfontsize);
0165                     
0166                     
0167                 
0168                 
0169             <span class="keyword">end</span>
0170         <span class="keyword">end</span>
0171     
0172 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 24-Feb-2017 14:46:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>